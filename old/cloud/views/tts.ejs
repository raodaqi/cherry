<% include header.ejs %>
<style type="text/css">
	body,html{
		margin: 0;
		padding:0;
		height: 100%;
		overflow: hidden !important;
		background-color: white;
	}
	.content{
		height: 100%;
	    width: 100%;
	    /*width: 1125px;*/
	    position: relative;
	    overflow: hidden;
	}
	.pages{
		position: absolute;
		width: 100%;
		height: 100%;
		top:0;
		left: 0;
		z-index: 1;
		overflow: hidden;
	}
	.pages {
	    -webkit-transition: all ease 500ms;
	    transition: all ease 500ms;
	    -webkit-transform: translate3d(0, 0, 0);
	    transform: translate3d(0, 0, 0);
	}
	.text-content{
		display: block;
		background:transparent;
		color: white;
		border:0;
		height: 100px;
		font-size: 18px;
		width: 100%;
		position: absolute;
		text-align: center;
		top:50%;
		margin: 0px;
		margin-top: -100px;
	}
	input[placeholder], [placeholder], *[placeholder] {
		color: white !important;
	}
	::-webkit-input-placeholder { /* WebKit browsers */
	color: white;
	}
	:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
	color: white;
	}
	::-moz-placeholder { /* Mozilla Firefox 19+ */
	color: white;
	}
	:-ms-input-placeholder { /* Internet Explorer 10+ */
	color: white;
	}
	.arrow{
		background-image: url("./img/arrow.svg");
		position:absolute;
		width: 40px;
		height:40px;
		bottom:30px;
		right:20px;
	}
	.share{
		/*background-image: url("./img/share.svg");
		background-size: cover;*/
		font-size: 30px;
		color:white;
		display: none;
		position:fixed;
		/*width: 40px;
		height:40px;*/
		bottom:30px;
		right:30px;
	}
	.return{
		/*background-image: url("./img/return.svg");*/
		font-size: 30px;
		color:white;
		position:fixed;
		/*width: 64px;
		height:48px;*/
		bottom:30px;
		left:-200px;
	}
	.page{
		/*width: 100%;
		height: 100%;*/
	}
	.index{
		/*left: -100%;*/
	}
	.choose{
		float: left;
		overflow-y:scroll !important;
	}
	.page {
		width: 100%;
		height: 100%;
	    overflow: hidden;
	    position: relative;
	    z-index: 2;
	    float: left;
	}
	.voice-content{
		/*position:absolute;
		overflow-y:scroll !important; */
	}
	.voice-ul{
		text-align: center;
		position:relative;
		padding-bottom: 70px;
		overflow:scroll !important;
	}
	.voice-li{
		display: inline-block;
		padding:10px;
		width: 50px;
		height: 70px;
		font-size: 12px;
		text-align: center;
	}
	.voice-img{
		width: 50px;
		/*height: 50px;*/
		height: 58px;
		margin-bottom: 5px;
		/*border-radius: 50%;*/
		/*background-color: #FF6A00;*/
	}
	label{
		color: #4A4A4A;
	}
	.voice-active label{
		color: white;
		padding: 1px 7px;
		border-radius: 6px;
		background: #0090ff;
	}

	.share-img{
		width: 50px;
		height: 50px;
		margin-bottom: 5px;
		border-radius: 25%;
		background-color: white;
	}

	.voice-menu{
		width: 80%;
		height: 30px;
		margin:30px auto;
		margin-bottom: 10px;
		border-radius: 5px;
		border: 1px solid #FDE7DC;
	}
	.menu-li{
		width: 33.3%;
		height: 30px;
		line-height: 30px;
		float: left;
		text-align: center;
		color:white;
		font-weight: bold;
	}
	.menu-li.active{
		background-color: #FFCCB4;
		color: white;
		font-weight: bold;
	}
	.load{
		position: absolute;
		width: 50px;
		text-align: center;
		margin-top: 10px;
	}
	.spinner {
	  width: 32px;
	  height: 40px;
	  text-align: center;
	  margin:0 auto;
	  font-size: 10px;
	  /*line-height: 110px;*/
	}

	.spinner > div {
	  background-color: white;
	  height: 100%;
	  width: 4px;
	  display: inline-block;

	  -webkit-animation: stretchdelay 1.2s infinite ease-in-out;
	  animation: stretchdelay 1.2s infinite ease-in-out;
	}

	.spinner .rect2 {
	  -webkit-animation-delay: -1.1s;
	  animation-delay: -1.1s;
	}

	.spinner .rect3 {
	  -webkit-animation-delay: -1.0s;
	  animation-delay: -1.0s;
	}

	.spinner .rect4 {
	  -webkit-animation-delay: -0.9s;
	  animation-delay: -0.9s;
	}

	.spinner .rect5 {
	  -webkit-animation-delay: -0.8s;
	  animation-delay: -0.8s;
	}

	@-webkit-keyframes stretchdelay {
	  0%, 40%, 100% { -webkit-transform: scaleY(0.4) }
	  20% { -webkit-transform: scaleY(1.0) }
	}

	@keyframes stretchdelay {
	  0%, 40%, 100% {
	    transform: scaleY(0.4);
	    -webkit-transform: scaleY(0.4);
	  }  20% {
	    transform: scaleY(1.0);
	    -webkit-transform: scaleY(1.0);
	  }
	}
	.share-content{
		position:fixed;
		bottom:0;
		height: 197px;
		width: 100%;
		background-color: #F1F1F1;
	}
	#share-ui-dialog .share-content{
		background: rgba(242,148,138,0.8);
	}
	.button-content{
		padding:0 10px;
		width: 100%;
		height: 100%;
		box-sizing: border-box;
	}
	.share-title{
		border-bottom: 1px solid #FFCCCC;
		width: 100%;
		text-align: center;
		font-weight: bold;
		color: white;
	}
	.button-content div{
		height: 65px;
		line-height: 65px;
	}
	.cancel-button{
		color: white;
		border-top: 1px solid #FFCCCC;
		width: 100%;
		text-align: center;
	}
	.share-button-ul{
	}
	.share-button-ul a{
		color: #737373;
		display: block;
		float: left;
		width: 25%;
		text-align: center;
	}
	.share-button-li{
		display: inline-block;
		color: white;
		width: 50px;
		font-size: 27px;
		text-align: center;
	}
	body,#share-ui-dialog .share-content{
	    background: -moz-linear-gradient(top, #E16961 0%, #EEA97D 100%);
	    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#E16961), color-stop(100%,#EEA97D));
	    background: -webkit-linear-gradient(top, #E16961 0%,#EEA97D 100%);
	    background: -o-linear-gradient(top, #E16961 0%,#EEA97D 100%);
	    background: -ms-linear-gradient(top, #E16961 0%,#EEA97D 100%);
	    background: linear-gradient(to bottom, #E16961 0%,#EEA97D 100%);
	}
	.index{
		background: url("/img/3-6-3.jpg");
		background-size: cover;
	}
	.choose{
		background: url("/img/3-6-4.jpg");
		background-size: cover;
	}
	.foot-bar{
		position: absolute;
		width: 100%;
		text-align: center;
    bottom: 30px;
	}
	.foot-button{
		width: 110px;
		height:30px;
		line-height: 30px;
		margin: 0 10px;
		color: white;
		border-radius: 20px;
		display: inline-block;
		background-color: #F0B091;
	}
</style>
<body>
	<!-- <textarea class="text-content" placeholder="输入一段你想说的话..."></textarea>  -->
	<div class="content">
		<!-- <input type="text" class="text-content" placeholder="输入一段你想说的话..."> -->
		<div class="pages">
			<div class="index page">
				<textarea class="text-content" placeholder="输入一段你想说的话..."></textarea>
				<!-- <div class="arrow"></div> -->
				<div class="foot-bar">
					<div class="random foot-button">?</div>
					<div class="create foot-button">生成</div>
				</div>
			</div>

			<div class="choose page">
				<div class="voice-content">
					<div class="voice-ul">
						<div class="voice-menu" >
							<% for(var i = 0; i < tts.length;i++ ){ %>
								<% if(i == 0){ %>
									<div class="menu-li active"  id="menu<%= i %>"><%= tts[i].type %></div>
								<% } else { %>
									<div class="menu-li"  id="menu<%= i %>"><%= tts[i].type %></div>
								<% } %>
							<% } %>
						</div>
					<% for(var i = 0; i < tts.length;i++ ){ %>
						<% if(i == 0){ %>
							<div class="voice-menu-content menu<%= i %>" style="margin-top: -10px;">
								<% for(var key in tts[i].content){ %>

						  			<div class="voice-li" data-vcn="<%= tts[i].content[key].vcn %>" >
						  				<div class="load" style="display: none;margin-top: 20px;">
											<div class="spinner">
												<div class="rect1"></div>
												<div class="rect2"></div>
												<div class="rect3"></div>
												<div class="rect4"></div>
												<div class="rect5"></div>
											</div>
										</div>

										<div class="voice-img" style="background: url(<%= tts[i].content[key].img %>) no-repeat;background-size: 100%;"></div>
										<label><%= tts[i].content[key].name%></label>
									</div>
						  		<% } %>
						  	</div>
						<% } else { %>
							<div class="voice-menu-content menu<%= i %>" style="display: none">
								<% for(var key in tts[i].content){ %>
						  			<div class="voice-li" data-vcn="<%= tts[i].content[key].vcn %>" >
						  				<div class="load" style="display: none">
											<div class="spinner">
												<div class="rect1"></div>
												<div class="rect2"></div>
												<div class="rect3"></div>
												<div class="rect4"></div>
												<div class="rect5"></div>
											</div>
										</div>
										<div class="voice-img" style="background: url(<%= tts[i].content[key].img %>) no-repeat;background-size: 100%;"></div>
										<label><%= tts[i].content[key].name%></label>
									</div>
						  		<% } %>
						  	</div>
						<% } %>
					 <% } %>

						<!-- <div class="voice-li">
							<div class="voice-img">
							</div>
							<label class="voice-active">普通话</label>
						</div>
						<div class="voice-li">
							<div class="voice-img">
							</div>
							<label>普通话</label>
						</div> -->

					</div>
				</div>
				<div class="return iconfont icon-zuojiantou"></div>
				<div class="share iconfont icon-zuihouyibanfenxiang"></div>
			</div>
		</div>
	</div>

	<div class="ui-dialog" id="share-ui-dialog">
	    <div class="share-content">
	    	<div class="button-content">
	    		<div class="share-title">
	    			分享
	    		</div>
	    		<div class="share-button-ul">
	    			<a href="javascript:share.qzone();">
		    			<div class="share-button-li iconfont icon-qzone">
		    			</div>
		    		</a>
		    		<a class="share-weixin">
		    			<div class="share-button-li iconfont icon-pengyouquan">
		    			</div>
		    		</a>
		    		<a href="javascript:share.weibo();">
		    			<div class="share-button-li iconfont icon-weibo">
		    			</div>
		    		</a>
		    		<a href="javascript:share.douban();">
		    			<div class="share-button-li iconfont icon-douban">
		    			</div>
		    		</a>
	    			<!-- <a href="javascript:share.qzone();">
		    			<div class="share-button-li">
		    				<div class="share-img"></div>
							<label>分享到QQ空间</label>
		    			</div>
		    		</a>
		    		<a class="share-weixin">
		    			<div class="share-button-li">
		    				<div class="share-img"></div>
							<label>分享到朋友圈</label>
		    			</div>
		    		</a>
	    			<a href="javascript:share.weibo();">
		    			<div class="share-button-li">
		    				<div class="share-img"></div>
							<label>分享到新浪微博</label>
		    			</div>
		    		</a>
		    		<a href="javascript:share.douban();">
		    			<div class="share-button-li">
		    				<div class="share-img"></div>
							<label>分享到豆瓣网</label>
		    			</div>
		    		</a> -->

	    		</div>
	    		<div class="cancel-button">
		    		取消
		    	</div>
	    	</div>

	    </div>
	</div>

	<!-- <audio src="" class="audio" id="audio" style="display:none">
		您的浏览器不支持 audio 标签。
	</audio> -->

<% include footer.ejs %>
	<script>
		var width = $(window).width();
		var height = $(window).height();
		$(".content").css({width:width*2});
		$(".page").css({width:width});
		$(".page").css({height:height});
		$(".return").css({"left":width+30+"px"});
		$(".share").show();
		console.log(width+" "+height);

		// $(".pages").css("-webkit-transform", "matrix(1, 0, 0, 1, -320, 0)");
		// $("#share-ui-dialog").show();
	</script>
	<script type="text/javascript">
		var url = '';

		var share = new SimpleShare({
				url: '',
				title: 'cherry|话说你的故事',
				content: '我用cherry说了一段话，快来听吧',
				pic: 'http://ac-83a4olkt.clouddn.com/bc2fc28bcd7f3c17.jpg'
			});

		$(".create").on("click",function(){
			var text = $(".text-content").val();
			// cherry.play(text);
			if(!text){
				cherry.tipShow("输入内容不能为空");
				return ;
			}else{
				$(".pages").css("-webkit-transform", "matrix(1, 0, 0, 1, -"+width+", 0)");
			}

		})

		$(".return").on("click",function(){
    		$(".pages").css("-webkit-transform", "matrix(1, 0, 0, 1, 0, 0)");
		})

		var textContent = ["你追我，如果你追到我，我就让你嘿嘿嘿","我呸我呸我呸呸呸","这个逼装的我给102分，多一分关心，多一分热爱",
		"可是臣妾做不到啊！臣妾做不到啊！做不到啊","一时之间，我竟没有抵抗", "跟着我就能够找到爱","今天天气好晴朗，处处好风光","被水淹没！不知所措",
	"两只老虎，两只老虎，跑得快！","像我这么好看的一个少女，你怎么还不向我表白。"];
		$(".random").on("click",function(){
			var length = textContent.length;
			var num = Math.floor(Math.random()*textContent.length);
			console.log(num);
    	$(".text-content").text(textContent[num]);
		})

		$(".share").on("click",function(){
			var data = {
		      	content : $(".text-content").val(),
		      	vcn     : $(".voice-active").data("vcn")
		      }
			$.ajax({
	          type : "POST",
	          data: data,
	          dataType: "json",
	          url : "/tts",
	          success : function(result){
	          	console.log(result);
	          	if(result == "102"){
	          		url = result;
		            $("#share-ui-dialog").show();
		            var share = new SimpleShare({
						url: result,
						title: 'cherry|话说你的故事',
						content: '我用cherry说了一段话，快来听吧',
						pic: 'http://ac-83a4olkt.clouddn.com/bc2fc28bcd7f3c17.jpg'
					});
		        }else{
		        	cherry.tipShow("您的网络有问题");
		        }
				// document.querySelector('.sharetotqq').addEventListener('click',function() {
				// 	share.tqq();
				// });

	          },
	          error: function(error){
	            console.log(error.responseText);
	            if(error.responseText != "102"){
	            	$("#share-ui-dialog").show();
	            	url = error.responseText;
		            share = new SimpleShare({
						url: error.responseText,
						title: 'cherry|话说你的故事',
						content: '我用cherry说了一段话，快来听吧。',
						pic: 'http://ac-83a4olkt.clouddn.com/bc2fc28bcd7f3c17.jpg'
					});
					// document.querySelector('.sharetotqq').addEventListener('click',function() {
					// 	share.tqq();
					// });
	            }
	          }
	        });

	        $(".share-weixin").on("click",function(){
	        	cherry.weixin(url);
	        })

			// var share = new SimpleShare({
			// 	url: 'http://www.taobao.com/',
			// 	title: 'cherry',
			// 	content: '话说你的故事',
			// 	pic: 'http://gtms01.alicdn.com/tps/i1/T1SwHiFnlkXXc.QAHh-202-55.png'
			// });
			// document.querySelector('.sharetotqq').addEventListener('click',function() {
			// 	share.tqq();
			// });
		})
		$(".cancel-button").on("click",function(){
			$("#share-ui-dialog").hide();
		})
		var $this = '';
		$(".voice-li").on("click",function(){
			$(".voice-li").removeClass("voice-active");
			$(this).addClass("voice-active");
			var content = $(".text-content").val();
			var vcn = $(".voice-active").data("vcn");
			$this = $(this);
			var audio = cherry.play(content,vcn,{
				success:function(audio){
					console.log(audio);
					audio.play();
					$(".load").hide();
					$this.children(".load").show();
					var is_playFinish = setInterval(function(){
						console.log(audio.ended);
						if(audio.ended){
							$(".load").hide();
							console.log("结束");
							$this.children(".load").hide();
							window.clearInterval(is_playFinish);
						}
					}, 10);
				},
				error:function(){
					$(".load").hide();
				}
			});
		})

		$(".menu-li").on("click",function(){
			$(".menu-li").removeClass("active");
			$(this).addClass("active");
			$(".voice-menu-content").hide();
			$("."+this.id).show();
		})



		// var data = {
	 //      	content : "你是傻逼",
	 //      	vcn     : "aisduck"
	 //      }
		// $.ajax({
  //         type : "POST",
  //         data: data,
  //         dataType: "json",
  //         url : "/tts",
  //         success : function(result){
  //           console.log(result);
  //         },
  //         error: function(error){
  //           alert(error);
  //         }
  //       });
	</script>
</html>
